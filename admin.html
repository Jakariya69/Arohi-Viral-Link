<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Power Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background-color: #f3f4f6; font-family: 'Inter', sans-serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .active-tab { background-color: #000; color: #fff; transform: scale(1.05); }
    </style>
</head>
<body class="max-w-xl mx-auto p-4 pb-24">

    <div id="login-screen" class="fixed inset-0 bg-slate-900 z-[200] flex items-center justify-center p-6">
        <div class="bg-white p-8 rounded-[40px] shadow-2xl w-full max-w-sm text-center">
            <h2 class="text-2xl font-black mb-6">Master Login</h2>
            <input id="pass-input" type="password" placeholder="Enter Password" class="w-full p-4 bg-gray-100 rounded-2xl mb-4 text-center font-bold outline-none">
            <button onclick="checkPass()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold">Unlock Control</button>
        </div>
    </div>

    <div id="main-ui" class="hidden">
        <div class="bg-white p-6 rounded-[35px] shadow-sm mb-6 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-black italic">Power Panel ⚡</h1>
                <p class="text-[10px] font-bold text-blue-600 uppercase">System Online</p>
            </div>
            <button onclick="location.reload()" class="bg-red-50 p-3 rounded-2xl"><i data-lucide="log-out" class="text-red-500"></i></button>
        </div>

        <div class="flex gap-2 overflow-x-auto mb-6 no-scrollbar py-2">
            <button onclick="showTab('v-tab', this)" class="tab-btn active-tab px-6 py-3 rounded-2xl font-bold whitespace-nowrap shadow-sm transition-all">Videos</button>
            <button onclick="showTab('w-tab', this)" class="tab-btn bg-white px-6 py-3 rounded-2xl font-bold whitespace-nowrap shadow-sm transition-all">Withdrawals</button>
            <button onclick="showTab('s-tab', this)" class="tab-btn bg-white px-6 py-3 rounded-2xl font-bold whitespace-nowrap shadow-sm transition-all">Settings</button>
        </div>

        <div id="v-tab" class="tab-content active space-y-4">
            <div class="bg-white p-6 rounded-[30px] shadow-sm">
                <h3 class="font-bold mb-4">Add New Video</h3>
                <div class="space-y-3">
                    <input id="vt" type="text" placeholder="Title" class="w-full p-4 bg-gray-50 rounded-2xl outline-none">
                    <input id="vth" type="text" placeholder="Thumbnail URL" class="w-full p-4 bg-gray-50 rounded-2xl outline-none">
                    <input id="vu" type="text" placeholder="Video Link" class="w-full p-4 bg-gray-50 rounded-2xl outline-none">
                    <button onclick="addV()" class="w-full bg-black text-white py-4 rounded-2xl font-bold">Upload Video</button>
                </div>
            </div>
            <div id="v-list" class="space-y-3">Loading Videos...</div>
        </div>

        <div id="w-tab" class="tab-content space-y-4">
            <div id="w-list" class="space-y-3 text-center py-10 text-gray-400">Loading Requests...</div>
        </div>

        <div id="s-tab" class="tab-content">
            <div class="bg-white p-6 rounded-[30px] shadow-sm">
                <h3 class="font-bold mb-4">App Settings</h3>
                <div class="space-y-4">
                    <input id="min-w" type="number" placeholder="Min Withdraw Amount" class="w-full p-4 bg-gray-50 rounded-2xl outline-none font-bold">
                    <button onclick="saveS()" class="w-full bg-green-600 text-white py-4 rounded-2xl font-bold">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = { apiKey: "AIzaSyCpNJm6i8cH6GNI5j2XQAiUgU7q-97c150", projectId: "mini-app-link", appId: "1:608662003617:web:681a069935bc118d5bb5e0" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function checkPass() {
            if(document.getElementById('pass-input').value === 'admin786') {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-ui').classList.remove('hidden');
                loadV(); loadW();
            } else { alert("Wrong Password!"); }
        }

        function showTab(id, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active-tab', 'bg-white'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active-tab');
            lucide.createIcons();
        }

        async function loadV() {
            const snap = await db.collection('episodes').orderBy('order', 'desc').get();
            const cont = document.getElementById('v-list'); cont.innerHTML = '';
            snap.forEach(doc => {
                const ep = doc.data();
                cont.innerHTML += `<div class="bg-white p-4 rounded-3xl flex justify-between items-center shadow-sm">
                    <div class="flex items-center gap-3">
                        <img src="${ep.thumb}" class="w-10 h-10 rounded-lg object-cover">
                        <span class="font-bold text-sm truncate w-32">${ep.title}</span>
                    </div>
                    <button onclick="delV('${doc.id}')" class="text-red-500 p-2"><i data-lucide="trash-2"></i></button>
                </div>`;
            });
            lucide.createIcons();
        }

        async function addV() {
            const t = document.getElementById('vt').value, th = document.getElementById('vth').value, u = document.getElementById('vu').value;
            if(!t || !th || !u) return alert("Fill all!");
            await db.collection('episodes').add({ title: t, thumb: th, url: u, order: Date.now() });
            alert("Added!"); loadV();
        }

        async function delV(id) { if(confirm("Delete?")) { await db.collection('episodes').doc(id).delete(); loadV(); } }

        async function loadW() {
            const snap = await db.collection('withdrawals').get();
            const cont = document.getElementById('w-list'); cont.innerHTML = '';
            if(snap.empty) cont.innerHTML = "No Requests Found";
            snap.forEach(doc => {
                const w = doc.data();
                cont.innerHTML += `<div class="bg-white p-6 rounded-[30px] shadow-sm border text-left">
                    <p class="font-black text-xl">৳${w.amount}</p>
                    <p class="text-sm font-bold text-gray-500">${w.method}: ${w.number}</p>
                    <button onclick="pay('${doc.id}')" class="mt-4 w-full bg-black text-white py-2 rounded-xl text-xs font-bold">Mark as Paid</button>
                </div>`;
            });
        }

        async function pay(id) { await db.collection('withdrawals').doc(id).delete(); loadW(); }

        async function saveS() {
            const min = document.getElementById('min-w').value;
            await db.collection('settings').doc('app_data').set({ min_withdraw: min }, { merge: true });
            alert("Updated!");
        }

        window.onload = () => lucide.createIcons();
    </script>
</body>
</html>
