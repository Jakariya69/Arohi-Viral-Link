<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mim Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Urbanist:wght@400;700;900&display=swap');
        body { font-family: 'Urbanist', sans-serif; background: #f1f5f9; display: none; } /* Initially hidden for security */
        .card { background: white; border-radius: 24px; padding: 20px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
    </style>
</head>
<body class="max-w-2xl mx-auto p-4 pb-20" id="admin-body">

    <header class="flex justify-between items-center mb-8 pt-4">
        <div>
            <h1 class="text-3xl font-black text-gray-900">Admin Control</h1>
            <p class="text-gray-500 font-bold text-sm">Manage Your Application</p>
        </div>
        <button onclick="location.reload()" class="bg-violet-600 p-3 rounded-2xl text-white shadow-lg">
            <i data-lucide="refresh-cw"></i>
        </button>
    </header>

    <section class="card mb-8 border-2 border-violet-100">
        <h2 class="text-lg font-black mb-4 flex items-center gap-2 text-violet-700">
            <i data-lucide="plus-circle"></i> Add New Content
        </h2>
        <div class="space-y-4">
            <input type="text" id="v-title" placeholder="Video Title" class="w-full p-4 bg-gray-50 border border-gray-100 rounded-xl outline-none font-bold">
            <input type="text" id="v-img" placeholder="Thumbnail Image URL" class="w-full p-4 bg-gray-50 border border-gray-100 rounded-xl outline-none font-bold">
            <input type="text" id="v-link" placeholder="Final Video Link" class="w-full p-4 bg-gray-50 border border-gray-100 rounded-xl outline-none font-bold">
            <button onclick="uploadVideo()" class="w-full bg-violet-600 text-white py-4 rounded-xl font-black shadow-lg">Publish Now</button>
        </div>
    </section>

    <section class="card">
        <h2 class="text-lg font-black mb-4 flex items-center gap-2 text-green-600">
            <i data-lucide="wallet"></i> Pending Withdrawals
        </h2>
        <div id="withdraw-list" class="space-y-3">
            <p class="text-center text-gray-400 py-10 font-bold">Checking requests...</p>
        </div>
    </section>

    <script>
        // --- Password Security ---
        const pass = prompt("Enter Admin Password:");
        if (pass === "admin786") {
            document.getElementById('admin-body').style.display = "block";
        } else {
            alert("Wrong Password! Access Denied.");
            window.location.href = "index.html"; // Redirect to home if wrong
        }

        // --- Firebase Config ---
        const firebaseConfig = {
            apiKey: "AIzaSyCpNJm6i8cH6GNI5j2XQAiUgU7q-97c150",
            authDomain: "mini-app-link.firebaseapp.com",
            databaseURL: "https://mini-app-link-default-rtdb.firebaseio.com",
            projectId: "mini-app-link",
            storageBucket: "mini-app-link.firebasestorage.app",
            messagingSenderId: "608662003617",
            appId: "1:608662003617:web:681a069935bc118d5bb5e0"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Upload Logic
        function uploadVideo() {
            const title = document.getElementById('v-title').value;
            const img = document.getElementById('v-img').value;
            const link = document.getElementById('v-link').value;

            if(!title || !img || !link) return alert("Fill all fields!");

            db.ref('tasks').push({
                title: title,
                image: img,
                link: link,
                time: Date.now()
            }).then(() => {
                alert("Success! Video added to app.");
                document.getElementById('v-title').value = "";
                document.getElementById('v-img').value = "";
                document.getElementById('v-link').value = "";
            });
        }

        // Fetch Withdrawals
        db.ref('withdrawals').on('value', snap => {
            const list = document.getElementById('withdraw-list');
            list.innerHTML = "";
            
            if(!snap.exists()) {
                list.innerHTML = `<p class="text-center text-gray-400 py-10 font-bold">No requests found.</p>`;
                return;
            }

            snap.forEach(child => {
                const data = child.val();
                const id = child.key;

                list.innerHTML += `
                    <div class="bg-gray-50 p-4 rounded-2xl border border-gray-100 flex justify-between items-center">
                        <div>
                            <p class="font-black text-gray-800">${data.method}: ${data.number}</p>
                            <p class="text-xs font-bold text-green-600">Amount: à§³${data.amount}</p>
                            <p class="text-[10px] text-gray-400 font-black">${new Date(data.time).toLocaleString()}</p>
                        </div>
                        <button onclick="deleteReq('${id}')" class="bg-red-100 text-red-600 p-3 rounded-xl">
                            <i data-lucide="check-circle" class="w-5 h-5"></i>
                        </button>
                    </div>`;
            });
            lucide.createIcons();
        });

        function deleteReq(id) {
            if(confirm("Mark as Paid and Delete?")) {
                db.ref('withdrawals').child(id).remove();
            }
        }

        lucide.createIcons();
    </script>
</body>
</html>
