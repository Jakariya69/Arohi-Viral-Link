<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arohi Mim Link ðŸ”ž</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background-color: #f3f4f6; font-family: 'Inter', sans-serif; }
        .page { display: none; }
        .page.active { display: block; }
        .nav-active { color: #8257e5 !important; }
    </style>
</head>
<body class="max-w-md mx-auto pb-24">

    <div class="bg-gray-900 text-white p-5 rounded-b-[30px] shadow-lg sticky top-0 z-50 flex justify-between items-center">
        <h1 class="text-lg font-black tracking-tight">Arohi Mim Link ðŸ”ž</h1>
        <div class="bg-white/10 px-4 py-2 rounded-2xl border border-white/20">
            <p class="text-[8px] uppercase font-bold opacity-60">Balance</p>
            <p class="text-sm font-black text-yellow-400">à§³<span id="user-balance">30.00</span></p>
        </div>
    </div>

    <div id="main-content" class="p-4">
        
        <div id="home-page" class="page active">
            <div id="video-container" class="space-y-6">
                <p class="text-center text-gray-400 py-10">Loading Viral Videos...</p>
            </div>
        </div>

        <div id="earn-page" class="page">
            <h2 class="text-xl font-black mb-4">Daily Rewards</h2>
            <div id="task-container" class="space-y-3">
                <div class="bg-white p-5 rounded-3xl shadow-sm border border-purple-100 flex justify-between items-center">
                    <div>
                        <p class="font-bold text-sm">Subscribe & Earn</p>
                        <p class="text-xs text-purple-600 font-bold">Reward: à§³10.00</p>
                    </div>
                    <button class="bg-purple-600 text-white px-5 py-2 rounded-xl text-xs font-bold">Go</button>
                </div>
            </div>
        </div>

        <div id="withdraw-page" class="page">
            <div class="bg-white p-6 rounded-[35px] shadow-sm border">
                <h2 class="text-lg font-black mb-4">Withdraw Money</h2>
                <div class="space-y-4">
                    <select id="w-method" class="w-full p-4 bg-gray-50 rounded-2xl outline-none font-bold">
                        <option value="Bkash">Bkash</option>
                        <option value="Nagad">Nagad</option>
                    </select>
                    <input id="w-number" type="number" placeholder="Bkash/Nagad Number" class="w-full p-4 bg-gray-50 rounded-2xl outline-none">
                    <input id="w-amount" type="number" placeholder="Enter Amount" class="w-full p-4 bg-gray-50 rounded-2xl outline-none">
                    <button onclick="handleWithdraw()" class="w-full bg-black text-white py-4 rounded-2xl font-bold">Withdraw Now</button>
                </div>
            </div>
        </div>

    </div>

    <nav class="fixed bottom-4 left-4 right-4 bg-white/80 backdrop-blur-md flex justify-around p-3 rounded-[25px] shadow-2xl border border-gray-100">
        <button onclick="openPage('home-page', this)" class="nav-item nav-active flex flex-col items-center">
            <i data-lucide="home" class="w-5 h-5"></i><span class="text-[10px] font-bold mt-1">Home</span>
        </button>
        <button onclick="openPage('earn-page', this)" class="nav-item text-gray-400 flex flex-col items-center">
            <i data-lucide="layout-grid" class="w-5 h-5"></i><span class="text-[10px] font-bold mt-1">Earn</span>
        </button>
        <button onclick="openPage('withdraw-page', this)" class="nav-item text-gray-400 flex flex-col items-center">
            <i data-lucide="wallet" class="w-5 h-5"></i><span class="text-[10px] font-bold mt-1">Withdraw</span>
        </button>
    </nav>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = { 
            apiKey: "AIzaSyCpNJm6i8cH6GNI5j2XQAiUgU7q-97c150", 
            projectId: "mini-app-link", 
            appId: "1:608662003617:web:681a069935bc118d5bb5e0" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // App Functions
        function openPage(pageId, btn) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('nav-active', 'text-gray-400'));
            btn.classList.add('nav-active');
            lucide.createIcons();
        }

        async function loadData() {
            // Load Videos
            const vSnap = await db.collection('episodes').get();
            const vCont = document.getElementById('video-container');
            vCont.innerHTML = '';
            vSnap.forEach(doc => {
                const data = doc.data();
                vCont.innerHTML += `
                <div class="bg-white p-4 rounded-[30px] shadow-sm border border-gray-100">
                    <img src="${data.thumb}" class="w-full h-48 rounded-[25px] object-cover mb-4">
                    <h3 class="font-bold text-gray-800 px-2">${data.title}</h3>
                    <button class="w-full bg-gray-900 text-white mt-4 py-4 rounded-2xl font-bold flex items-center justify-center gap-2">
                        <i data-lucide="lock" class="w-4 h-4"></i> Unlock Video
                    </button>
                </div>`;
            });

            // Load Tasks
            const tSnap = await db.collection('tasks').get();
            const tCont = document.getElementById('task-container');
            if(!tSnap.empty) {
                tCont.innerHTML = '';
                tSnap.forEach(doc => {
                    const t = doc.data();
                    tCont.innerHTML += `
                    <div class="bg-white p-5 rounded-3xl shadow-sm border border-gray-100 flex justify-between items-center">
                        <div><p class="font-bold text-sm">${t.title}</p><p class="text-xs text-green-600 font-bold">à§³${t.amount}</p></div>
                        <a href="${t.link}" target="_blank" class="bg-black text-white px-6 py-2 rounded-xl text-xs font-bold">Complete</a>
                    </div>`;
                });
            }
            lucide.createIcons();
        }

        async function handleWithdraw() {
            const num = document.getElementById('w-number').value;
            const amt = document.getElementById('w-amount').value;
            const method = document.getElementById('w-method').value;
            if(!num || !amt) return alert("Please fill all details!");
            
            await db.collection('withdrawals').add({
                number: num, amount: amt, method: method, status: "pending", time: Date.now()
            });
            alert("Withdrawal Request Sent Successfully!");
        }

        window.onload = () => { lucide.createIcons(); loadData(); };
    </script>
</body>
</html>
